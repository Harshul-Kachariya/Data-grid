const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AddItemDropdown-Cnka2GWm.js","assets/vendor-react-B3mkRaNr.js","assets/vendor-EceFjBgE.js","assets/vendor-aggrid-1u-ABy05.js","assets/Sidebar-BW5jnxcu.js"])))=>i.map(i=>d[i]);
import{f as R,b as c,u as _e,g as Ie,j as s,M as we,F as k,h as Ce,k as F,l as ve,m as Ne,n as Te,o as De,D as G,H as Q,A as je,p as Re,P as q,q as ke}from"./vendor-react-B3mkRaNr.js";import{d as Ae,t as E,f as L,p as g,s as A,h as Oe,i as Ue,j as Me,T as Le,k as Pe}from"./vendor-EceFjBgE.js";import{M as Fe,z as Ge,D as Qe}from"./vendor-aggrid-1u-ABy05.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const O="FETCH_GRID_DATA_REQUEST",$="FETCH_GRID_DATA_SUCCESS",B="FETCH_GRID_DATA_FAILURE",H="ADD_SECTION_REQUEST",z="ADD_SECTION_SUCCESS",V="UPDATE_SECTION_REQUEST",Y="UPDATE_SECTION_SUCCESS",W="DELETE_SECTION_REQUEST",Z="DELETE_SECTION_SUCCESS",K="COPY_SECTION_REQUEST",J="COPY_SECTION_SUCCESS",X="ADD_ITEM_REQUEST",ee="ADD_ITEM_SUCCESS",te="DELETE_ITEM_REQUEST",se="DELETE_ITEM_SUCCESS",oe="MOVE_SECTION_REQUEST",ne="MOVE_SECTION_SUCCESS",qe={data:[],groupedItems:[],loading:!1,error:null};function $e(e=qe,t){switch(t.type){case O:return{...e,loading:!0,error:null};case $:return{...e,loading:!1,data:t.payload.items,groupedItems:t.payload.groupedItems};case B:return{...e,loading:!1,error:t.payload};case z:return{...e,groupedItems:[t.payload,...e.groupedItems]};case Y:return{...e,groupedItems:e.groupedItems.map(r=>r.section_id===t.payload.sectionId?{...r,...t.payload.updates}:r)};case Z:return{...e,groupedItems:e.groupedItems.filter(r=>r.section_id!==t.payload)};case J:const{newSection:i,insertAfterId:l}=t.payload,n=e.groupedItems.findIndex(r=>r.section_id===l),a=[...e.groupedItems];return a.splice(n+1,0,i),{...e,groupedItems:a};case ee:return{...e,groupedItems:e.groupedItems.map(r=>r.section_id===t.payload.sectionId?{...r,items:[...r.items,t.payload.newItem]}:r)};case se:return{...e,groupedItems:e.groupedItems.map(r=>r.section_id===t.payload.sectionId?{...r,items:r.items.filter(d=>d.item_id!==t.payload.itemId)}:r)};case ne:return{...e,groupedItems:t.payload};default:return e}}const Be=()=>({type:O,payload:void 0}),He=e=>({type:$,payload:e}),ze=e=>({type:B,payload:e}),Ve=e=>({type:H,payload:e}),Ye=e=>({type:z,payload:e}),We=(e,t)=>({type:V,payload:{sectionId:e,updates:t}}),Ze=(e,t)=>({type:Y,payload:{sectionId:e,updates:t}}),Ke=e=>({type:W,payload:e}),Je=e=>({type:Z,payload:e}),Xe=e=>({type:K,payload:e}),et=(e,t)=>({type:J,payload:{newSection:e,insertAfterId:t}}),tt=(e,t)=>({type:X,payload:{sectionId:e,item:t}}),st=(e,t)=>({type:ee,payload:{sectionId:e,newItem:t}}),ot=(e,t)=>({type:te,payload:{sectionId:e,itemId:t}}),nt=(e,t)=>({type:se,payload:{sectionId:e,itemId:t}}),rt=(e,t)=>({type:oe,payload:{fromIndex:e,toIndex:t}}),at=e=>({type:ne,payload:e});function it(){return fetch("/data.json").then(e=>e.json()).then(e=>{const t=e.data.EstimateItem||[],i=new Map;t.forEach(n=>i.set(n.section_id,n.section_name));const l=Array.from(i,([n,a])=>({section_id:n,section_name:a,items:[]}));return{items:t,sections:l}})}function lt(e,t){const i={};return e.forEach(l=>{i[l.section_id]||=[],i[l.section_id].push(l)}),t.map(l=>({...l,items:i[l.section_id]||[]}))}function*ct(){try{const{items:e,sections:t}=yield L(it),i=yield L(lt,e,t);yield g(He({items:e,groupedItems:i}))}catch(e){yield g(ze(e.message))}}function*dt({payload:e}){const{name:t,description:i,isOptional:l}=e,n={section_id:Date.now(),section_name:t,description:i,isOptional:l,items:[]};yield g(Ye(n))}function*ut({payload:e}){yield g(Ze(e.sectionId,e.updates))}function*mt({payload:e}){yield g(Je(e))}function*pt({payload:e}){const t=e,i=yield A(d=>d.grid.groupedItems),l=i.findIndex(d=>d.section_id===t);if(l===-1)return;const n=i[l],a=Date.now(),r={...n,section_id:a,section_name:`${n.section_name} (Copy)`,items:n.items.map(d=>({...d,item_id:Date.now()+Math.random(),section_id:a}))};yield g(et(r,t))}function*ft({payload:e}){const{sectionId:t,item:i}=e,l=yield A(a=>a.grid.groupedItems.find(r=>r.section_id===t)),n={...i,item_id:Date.now(),section_id:t,section_name:l.section_name,date_added:new Date().toISOString()};yield g(st(t,n))}function*ht({payload:e}){yield g(nt(e.sectionId,e.itemId))}function*St({payload:e}){const{fromIndex:t,toIndex:i}=e,n=[...yield A(r=>r.grid.groupedItems)],[a]=n.splice(t,1);n.splice(i,0,a),yield g(at(n))}function*xt(){yield Ae([E(O,ct),E(H,dt),E(V,ut),E(W,mt),E(K,pt),E(X,ft),E(te,ht),E(oe,St)])}const re=Oe(),gt=Ue({grid:$e}),ae=Me({reducer:gt,middleware:e=>e({serializableCheck:!1,immutableCheck:!1}).concat(re)});re.run(xt);const yt="modulepreload",Et=function(e){return"/"+e},P={},ie=function(t,i,l){let n=Promise.resolve();if(i&&i.length>0){let r=function(p){return Promise.all(p.map(h=>Promise.resolve(h).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),y=d?.nonce||d?.getAttribute("nonce");n=r(i.map(p=>{if(p=Et(p),p in P)return;P[p]=!0;const h=p.endsWith(".css"),x=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${x}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":yt,h||(m.as="script"),m.crossOrigin="",m.href=p,y&&m.setAttribute("nonce",y),document.head.appendChild(m),h)return new Promise((b,I)=>{m.addEventListener("load",b),m.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${p}`)))})}))}function a(r){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=r,window.dispatchEvent(d),!d.defaultPrevented)throw r}return n.then(r=>{for(const d of r||[])d.status==="rejected"&&a(d.reason);return t().catch(a)})},bt=({section:e,index:t,moveSection:i,displayedSections:l,children:n,onViewSection:a,onAddItem:r,copysection:d,deletesection:y})=>{const[p,h]=c.useState(!0),[x,m]=c.useState(!1),b=c.useRef(null),[,I]=_e({type:"SECTION",item:{id:e.section_id,index:t},collect:S=>({isDragging:S.isDragging()})}),[,w]=Ie({accept:"SECTION",hover(S){if(!b.current)return;const C=l.findIndex(N=>N.section_id===S.id),v=t;C!==v&&(i(C,v),S.index=v)}});return I(w(b)),s.jsxs("div",{ref:b,className:"mb-6 border rounded shadow bg-white transition-opacity",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-100 border-b",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(we,{className:"cursor-grab rotate-90"}),s.jsxs("h2",{className:"font-semibold text-lg cursor-pointer",onClick:()=>h(S=>!S),children:[p?"▾":"▸"," ",e.section_name]})]}),s.jsxs("div",{className:"flex items-center gap-2 relative",children:[s.jsx("button",{className:"p-2 rounded hover:bg-gray-200",onClick:()=>a(e),children:s.jsx(k,{className:"text-lg"})}),s.jsxs("div",{className:"relative",children:[s.jsx("button",{className:"p-2 rounded hover:bg-gray-200",onClick:()=>m(S=>!S),children:s.jsx(Ce,{className:"text-lg"})}),x&&s.jsxs("div",{className:"absolute right-0 mt-2 w-40 bg-white border rounded shadow z-10",children:[s.jsx("button",{onClick:()=>{r(e.section_id),m(!1)},className:"w-full text-left px-4 py-2 hover:bg-gray-100",children:"Add New Item"}),s.jsx("button",{onClick:()=>{d(e.section_id),m(!1)},className:"w-full text-left px-4 py-2 hover:bg-gray-100",children:"Copy Section"}),s.jsx("button",{onClick:()=>{y(e.section_id),m(!1)},className:"w-full text-left px-4 py-2 hover:bg-gray-100",children:"Delete Section"})]})]})]})]}),p&&s.jsx("div",{className:"p-2",children:n})]})},_t=R.memo(bt),It=({showMarkup:e,setShowMarkup:t})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors
          ${e?"bg-black text-white":"bg-gray-200 text-gray-700"}`,onClick:()=>t(!0),children:[s.jsx(k,{className:"text-lg"}),"Show Markup"]}),s.jsxs("button",{className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors
          ${e?"bg-gray-200 text-gray-700":"bg-black text-white"}`,onClick:()=>t(!1),children:[s.jsx(F,{className:"text-lg"}),"Hide Markup"]})]}),wt=({selectedFilter:e,setSelectedFilter:t})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:"Show Only ₹0 Items:"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{className:`px-4 py-2 rounded-md transition-colors ${e==="yes"?"bg-black text-white":"bg-gray-200 text-gray-700"}`,onClick:()=>t("yes"),children:"Yes"}),s.jsx("button",{className:`px-4 py-2 rounded-md transition-colors ${e==="no"?"bg-black text-white":"bg-gray-200 text-gray-700"}`,onClick:()=>t("no"),children:"No"})]})]}),Ct=()=>{const[e,t]=c.useState(!1),[i,l]=c.useState(!0);c.useEffect(()=>{const a=()=>{t(window.scrollY>300)};return window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[]);const n=()=>window.scrollTo({top:0,behavior:"smooth"});return!e||!i?null:s.jsx("div",{className:"fixed bottom-8 right-8 z-50",children:s.jsxs("div",{className:"relative group",children:[s.jsx("button",{onClick:n,className:"bg-black text-white p-3 rounded-full shadow-lg transition-all duration-300 hover:shadow-xl active:transform active:scale-95",children:s.jsx("div",{className:"relative w-6 h-6 flex items-center justify-center",children:s.jsx(ve,{className:"text-lg"})})}),s.jsx("div",{role:"button",tabIndex:0,onClick:a=>{a.stopPropagation(),l(!1)},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),l(!1))},className:"absolute -top-2 -right-2 bg-white text-black rounded-full p-1 transition-colors duration-200 invisible group-hover:visible flex items-center justify-center cursor-pointer hover:bg-gray-100 w-5 h-5",children:s.jsx(Ne,{className:"text-xs"})})]})})},vt=e=>s.jsx(Le,{title:e.value,arrow:!0,placement:"top",componentsProps:{tooltip:{sx:{bgcolor:"#2b2b2b",color:"#f0f0f0",fontSize:"14px",fontWeight:500,boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.3)",borderRadius:"8px",py:1.2,px:1.5,maxWidth:300,whiteSpace:"pre-line",lineHeight:1.5}},arrow:{sx:{color:"#2b2b2b"}}},children:s.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"100%",cursor:"pointer"},children:e.value})}),Nt=c.lazy(()=>ie(()=>import("./AddItemDropdown-Cnka2GWm.js"),__vite__mapDeps([0,1,2,3]))),Tt=c.lazy(()=>ie(()=>import("./Sidebar-BW5jnxcu.js"),__vite__mapDeps([4,1,2,3])));Fe.registerModules([Ge]);const Dt=()=>{const e=Te(),{groupedItems:t,loading:i,error:l}=De(o=>o.grid),[n,a]=c.useState({}),[r,d]=c.useState([]),[y,p]=c.useState(!1),[h,x]=c.useState("no"),[m,b]=c.useState(!0),[I,w]=c.useState(!1),[S,C]=c.useState("itemDetails"),[v,N]=c.useState(),[le,ce]=c.useState(null),[de,ue]=c.useState(null),T=c.useRef(null),D=c.useRef(null),me=c.useRef({}),[pe,fe]=c.useState(!1);c.useEffect(()=>{const o=setTimeout(()=>{e(Be())},100);return()=>clearTimeout(o)},[e]),c.useEffect(()=>{if(!t.length)return;const o={};t.forEach(u=>{o[u.section_id]=u.items}),a(o),d(t.slice(0,1))},[t]),c.useEffect(()=>{const o=new IntersectionObserver(u=>{u[0].isIntersecting&&!y&&r.length<t.length&&(p(!0),setTimeout(()=>{d(_=>[..._,...t.slice(_.length,_.length+1)]),p(!1)},500))},{root:null,rootMargin:"20px",threshold:.1});return T.current=o,()=>o.disconnect()},[r,y,t]),c.useEffect(()=>{D.current&&T.current&&T.current.observe(D.current)},[r]);const U=c.useRef(Pe((o,u)=>{C(o),o==="itemDetails"?ue(u):o==="sectionDetails"&&ce(u),w(!0)},100)).current,M=o=>o.value?`₹${Number(o.value).toLocaleString()}`:"",he=o=>s.jsx("button",{onClick:u=>{u.stopPropagation(),U("itemDetails",o.data)},className:"text-blue-500 hover:text-blue-700 transition-colors duration-200",children:s.jsx(k,{className:"text-lg text-black"})}),Se=o=>s.jsx("button",{onClick:u=>{u.stopPropagation(),e(ot(o.data.section_id,o.data.item_id))},className:"text-red-500 hover:text-red-700 transition-colors duration-200",children:s.jsx(Re,{className:"text-lg"})}),xe=(o,u)=>{e(rt(o,u))},ge=[{headerName:"",rowDrag:!0,colId:"rowDragCol",width:30,pinned:"left",sortable:!1,resizable:!1,filter:!1,editable:!1,cellClass:"hover-drag"},{headerName:"",checkboxSelection:!0,headerCheckboxSelection:!0,colId:"checkboxCol",width:40,pinned:"left",sortable:!1,resizable:!1,filter:!1,editable:!1,cellClass:()=>pe?"always-show-checkbox":"hover-checkbox"},{headerName:"Item ID",field:"item_id",flex:2,tooltipValueGetter:o=>`Item ID: ${o.value}`},{headerName:"Subject",field:"subject",flex:2,valueGetter:o=>o.data.subject??"",editable:!0},{headerName:"Quantity",field:"quantity",flex:2},{headerName:"Unit",field:"unit",flex:2},{headerName:"Unit Cost",field:"unit_cost",cellRenderer:M,flex:2},{headerName:"Markup",field:"markup",flex:2,cellRenderer:o=>m?o.value:s.jsx(F,{className:"text-lg text-gray-500"})},{headerName:"Total",field:"total",cellRenderer:M,flex:2},{headerName:"Item Type",field:"item_type_display_name",flex:2},{headerName:"Section Name",field:"section_name",flex:2},{headerName:"Date Added",field:"date_added",valueFormatter:o=>o.value?new Date(o.value).toLocaleString():"",flex:2},{headerName:"",field:"view",cellRenderer:he,width:35,sortable:!1,filter:!1,editable:!1},{headerName:"",field:"delete",cellRenderer:Se,width:40,sortable:!1,filter:!1,editable:!1}],ye=c.useMemo(()=>ge.map(o=>{const u=["view","delete","markup","quantity","unit","section_name"];return o.field&&!u.includes(o.field)?{...o,cellRenderer:vt}:o}),[m]);return i?s.jsx("div",{children:"Loading..."}):l?s.jsxs("div",{children:["Error: ",l]}):s.jsx(G,{backend:Q,children:s.jsxs("div",{className:"relative min-h-screen",children:[s.jsx("div",{className:"mb-8 flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-2 justify-between w-full",children:[s.jsx(It,{showMarkup:m,setShowMarkup:b}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(wt,{selectedFilter:h,setSelectedFilter:x}),s.jsx(R.Suspense,{fallback:s.jsx("div",{className:"text-sm text-gray-400",children:i?s.jsx("span",{children:"Loading..."}):null}),children:s.jsx(Nt,{onAddSection:()=>{C("addSection"),w(!0)}})})]})]})}),s.jsxs("div",{id:"grid-wrapper",className:`overflow-x-hidden overflow-y-auto transition-all duration-300 ${I?"backdrop-blur-sm":""}`,children:[r.map((o,u)=>{const _=n[o.section_id]||o.items||[],Ee=h==="yes"?_.filter(f=>{const j=Number(f.unit_cost?.replace("₹",""))||0,be=Number(f.total?.replace("₹",""))||0;return j===0&&be===0}):_;return s.jsx("div",{className:"section-block-wrapper min-h-[400px]",children:s.jsx(_t,{section:o,index:u,moveSection:xe,displayedSections:r,onViewSection:f=>{U("sectionDetails",f)},onAddItem:f=>{N(f),C("addItem"),w(!0)},copysection:f=>e(Xe(f)),deletesection:f=>e(Ke(f)),children:s.jsx("div",{className:"w-[140%] ag-theme-balham",children:s.jsx(je,{theme:Qe,rowData:Ee,rowModelType:"clientSide",rowBuffer:10,columnDefs:ye,defaultColDef:{sortable:!0,resizable:!0,editable:!0},domLayout:"autoHeight",rowSelection:"multiple",rowDragManaged:!0,rowDragMultiRow:!0,animateRows:!0,suppressRowClickSelection:!0,onGridReady:f=>me.current[o.section_id]=f.api,getRowId:f=>f.data.item_id,enableBrowserTooltips:!0,onSelectionChanged:f=>{const j=f.api.getSelectedRows().length;fe(j>0)}})})})},o.section_id)}),r.length<t.length&&s.jsx("div",{ref:D,className:`text-center py-4 ${y?"visible":"invisible"}`,children:s.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-black border-t-transparent"})})]}),s.jsx(R.Suspense,{fallback:s.jsx("div",{className:"text-sm text-gray-400",children:"Loading sidebar..."}),children:s.jsx(Tt,{isOpen:I,onClose:()=>w(!1),mode:S,onAddSection:o=>e(Ve(o)),onUpdateSection:(o,u)=>e(We(o,u)),onAddItem:(o,u)=>e(tt(o,u)),currentSectionId:v,sectionData:le,itemData:de})}),s.jsx(Ct,{})]})})},jt=()=>s.jsx(q,{store:ae,children:s.jsxs("div",{className:"container mx-auto p-4",children:[s.jsx("h1",{className:"mb-4",children:"Data Grid"}),s.jsx(G,{backend:Q,children:s.jsx(Dt,{})})]})});ke.createRoot(document.getElementById("root")).render(s.jsx(q,{store:ae,children:s.jsx(jt,{})}));
